<!DOCTYPE html>
<html>
<head>
  <title>Fee History | {{ student.admission_id }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    .official-print-head,
    .official-print-foot {
      font-family: "Times New Roman", Times, serif;
    }
    .official-print-head {
      text-align: center;
      border-bottom: 2px solid #222;
      margin-bottom: 10px;
      padding-bottom: 6px;
    }
    .official-print-head .t1 { font-size: 36px; font-weight: 700; }
    .official-print-head .t2 { font-size: 14px; }
    .official-print-head .t3 { font-size: 28px; margin-top: 6px; }
    .official-print-foot {
      border-top: 2px solid #222;
      margin-top: 14px;
      padding-top: 6px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      font-size: 13px;
    }
    .official-print-foot .r { text-align: right; }
    @media print {
      .official-print-head .t1 { font-size: 30px; }
      .official-print-head .t3 { font-size: 22px; }
      .no-print { display: none !important; }
    }
  </style>
</head>
<body>
  <div class="dashboard employee-page student-list-page">
    <div class="official-print-head">
      <div class="t1">Sri Venkateshwara Polytechnic</div>
      <div class="t2">(A Unit of Nehru Smaraka Vidya Kendra Trust, Bangalore) | Recognised by AICTE New Delhi and Govt. of Karnataka</div>
      <div class="t3">Fee History Statement</div>
    </div>

    <div class="header">
      <h2>Fee History - {{ student.student_name }}</h2>
      <p class="subtitle">{{ student.branch }} | {{ student.admission_id }}{% if student.college_reg_no %} | {{ student.college_reg_no }}{% endif %} | Current Period: {{ default_academic_year }} / Sem {{ current_sem }}</p>
    </div>

    <div class="table-actions no-print">
      <a class="link action-link back-dashboard-link" href="/admin/fees">Back to Fees</a>
    </div>

    {% if msg %}
      <div class="employee-filters-card" style="margin-bottom: 10px;">
        <b>{{ msg }}</b>
      </div>
    {% endif %}

    <div class="employee-table-card">
      <div class="table-wrap">
        <table class="employee-table">
          <thead>
            <tr>
              <th>Current Sem</th>
              <th>Admission Due</th>
              <th>Tuition Due</th>
              <th>Management Due</th>
              <th>Exam Due</th>
              <th>Total Due</th>
              <th>Total Paid</th>
              <th>Balance</th>
              <th>Fee State</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>{{ student.current_sem }}</td>
              <td>{{ student.admission_due_total }}</td>
              <td>{{ student.tuition_due_total }}</td>
              <td>{{ student.management_due_total }}</td>
              <td>{{ student.exam_due_total }}</td>
              <td>{{ student.total_due }}</td>
              <td>{{ student.total_paid }}</td>
              <td>{{ student.balance }}</td>
              <td>{{ student.payment_state }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    {% if can_manage_fees %}
    <div class="employee-filters-card no-print" style="margin-top: 12px;">
      <form method="post" action="/admin/fees/student/{{ student.admission_id }}/add-payment" class="employee-filters student-filters">
        <select name="fee_type" required>
          <option value="ADMISSION">ADMISSION</option>
          <option value="TUITION">TUITION</option>
          <option value="MANAGEMENT">MANAGEMENT</option>
          <option value="EXAM">EXAM</option>
        </select>
        <input type="text" name="academic_year" value="{{ default_academic_year }}" placeholder="Academic Year">
        <input type="number" name="semester_no" min="1" max="6" value="{{ current_sem }}" placeholder="Semester">
        <input type="number" step="0.01" min="0.01" name="amount" placeholder="Amount Paid" required>
        <input type="date" name="payment_date" value="{{ today_iso }}" required>
        <input type="text" name="remarks" placeholder="Remarks (optional)">
        <button type="submit">Add Payment</button>
      </form>
    </div>
    {% else %}
    <div class="employee-filters-card no-print" style="margin-top: 12px;">
      <b>View only access:</b> only Admin, HOD, or Management staff can add/edit fee details.
    </div>
    {% endif %}

    <div class="employee-table-card">
      <div class="table-wrap">
        <table class="employee-table">
          <thead>
            <tr>
              <th>SI NO</th>
              <th>Date</th>
              <th>Receipt No</th>
              <th>Type</th>
              <th>Academic Year</th>
              <th>Sem</th>
              <th>Amount</th>
              <th>Remarks</th>
              <th class="no-print">Receipt</th>
            </tr>
          </thead>
          <tbody>
            {% for p in payments %}
              <tr>
                <td>{{ loop.index }}</td>
                <td>{{ p.payment_date }}</td>
                <td>{{ p.receipt_no }}</td>
                <td>{{ p.fee_type }}</td>
                <td>{{ p.academic_year if p.academic_year else '-' }}</td>
                <td>{{ p.semester_no if p.semester_no else '-' }}</td>
                <td>{{ p.amount }}</td>
                <td>{{ p.remarks if p.remarks else '-' }}</td>
                <td class="no-print"><a class="table-link" href="/admin/fees/payment/{{ p.id }}/receipt">Download</a></td>
              </tr>
            {% else %}
              <tr>
                <td colspan="9">No payment history available.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div class="official-print-foot">
      <div>E-mail ID: srivenkateshwara364@gmail.com</div>
      <div class="r">Website: www.svpolytechnic.edu.in</div>
    </div>
  </div>
</body>
</html>
